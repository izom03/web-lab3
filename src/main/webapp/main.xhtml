<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="jakarta.faces.facelets">
<h:head>
    <title>Lab3</title>
    <link rel="stylesheet" href="style/style.css"/>
</h:head>
<h:body>
    <header class="info-panel">
        <div class="title">
            <h1 class="main-title">Web Programming Lab №3</h1>
            <h3>Лихачев Владлен, P3330, вариант 122545</h3>
        </div>
        <div class="back-button">
            <h:button type="button" id="back-button" outcome="toIndex" value="Назад"/>
        </div>
    </header>
    <h:panelGroup layout="block" class="main-layout" id="main-panel">
        <h:panelGroup layout="block" class="form-column">
            <h:panelGroup layout="block" class="form-panel">
                <h2>Выбор точки</h2>
                <h:form id="graphForm">
                    <h3>Выберите координату X:</h3>
                    <ui:repeat value="#{formBean.xRange}" var="val">
                        <h:commandLink value="#{val}"
                                        action="#{formBean.nop}"
                                        styleClass="#{formBean.xValue != null and val == formBean.xValue ? 'active-link' : 'default-link'}">
                            <f:setPropertyActionListener target="#{formBean.xValue}" value="#{val}.0"/>
                            <f:ajax execute="@this" render="@form"/>
                        </h:commandLink>
                    </ui:repeat>
                    <h3>Введите значение Y:</h3>
                    <h:panelGroup layout="block" class="y-value-container">
                        <h:inputText id="yValue" value="#{formBean.yValue}" styleClass="input-field"
                                        onkeydown="if(event.key==='Enter'){ mojarra.ab(this, event, 'change', '@this', '@form');;return false; }" 
                                        onchange="mojarra.ab(this, event, 'change', '@this', '@form');">
                            <f:converter converterId="floatConverter"/>
                            <f:validator validatorId="strictRangeValidator"/>
                        </h:inputText>
                        <h:outputText value="#{formBean.yValue == null ? 'Нет' : formBean.yValue}" 
                                        styleClass="#{formBean.yValue != null ? 'active-y-value' : 'default-y-value'}"/>
                    </h:panelGroup>
                    <h:message id="yValueMessage" for="yValue" styleClass="input-error"/>
                    <h3>Выберите множитель R:</h3>
                    <ui:repeat value="#{formBean.rRange}" var="val">
                        <h:commandButton value="#{val}"
                                            action="#{formBean.nop}"
                                            styleClass="#{formBean.rValue != null and val == formBean.rValue ? 'active-button' : 'default-button'}">
                            <f:setPropertyActionListener target="#{formBean.rValue}" value="#{val}.0"/>
                            <f:ajax execute="@this" render="@form main-panel"/>
                        </h:commandButton>
                    </ui:repeat>
                    <h:panelGroup layout="block" class="submit-panel">
                        <h:commandButton value="Отправить" action="#{formBean.addNewPoint}"
                                        styleClass="submit-button"
                                        disabled="#{formBean.xValue == null or formBean.yValue == null or formBean.rValue == null}">
                            <f:ajax render="@form main-panel"/>
                        </h:commandButton>
                        <h:commandButton value="Очистить" action="#{formBean.clearAllPoints}"
                                        styleClass="submit-button">
                            <f:ajax render="@form main-panel"/>
                        </h:commandButton>
                    </h:panelGroup>
                    <h:inputHidden id="cx" value="#{formBean.xClick}"/>
                    <h:inputHidden id="cy" value="#{formBean.yClick}"/>
                    <h:commandButton id="clickBtn" action="#{formBean.addNewClickPoint}"
                                    style="display:none">
                        <f:ajax render="main-panel" execute="@form"/>
                    </h:commandButton>
                </h:form>
            </h:panelGroup>
        </h:panelGroup>
        <h:panelGroup layout="block" class="graph-column">
            <h:panelGroup layout="block" class="graph-panel">
                <h:panelGroup layout="block"  id="click_catcher">
                    <h:outputText value="#{graphBean.fullSvgElement}" escape="false"/>
                </h:panelGroup>
            </h:panelGroup>
        </h:panelGroup>
        <h:panelGroup layout="block" class="result-column">
            <h:panelGroup layout="block" class="result-panel">
                <h:panelGroup layout="block" class="result-table-wrapper">
                    <h:dataTable class="result-table" id="result" var="res" value="#{pointSessionBean.points}" style="width: 100%">
                        <h:column>
                            <f:facet name="header">X</f:facet>
                            #{res.formattedX}
                        </h:column>
                        <h:column>
                            <f:facet name="header">Y</f:facet>
                            #{res.formattedY}
                        </h:column>
                        <h:column>
                            <f:facet name="header">R</f:facet>
                            #{res.r}
                        </h:column>
                        <h:column>
                            <f:facet name="header">Входит?</f:facet>
                            #{res.insideArea? "Да" : "Нет"}
                        </h:column> 
                        <h:column>
                            <f:facet name="header">Время</f:facet>
                            <h:outputText value="#{res.timestamp}">
                                <f:convertDateTime pattern="dd.MM HH:mm:ss.SSS"/>
                            </h:outputText>
                        </h:column>
                        <h:column>
                            <f:facet name="header">Выполнение</f:facet>
                            #{res.executionTime} нс
                        </h:column>
                    </h:dataTable>
                </h:panelGroup>
            </h:panelGroup>
        </h:panelGroup>
    </h:panelGroup>
    <script type="text/javascript" src="script/graph.js"></script>
</h:body>
</html>